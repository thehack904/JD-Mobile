{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-2">
  <div class="text-muted small">Packages</div>
  <a class="btn btn-primary btn-sm" href="/add">Add</a>
</div>

{% if not packages %}
  <div class="card"><div class="card-body">No packages (or JD API not reachable).</div></div>
{% endif %}

<div class="list-group">
  {% for p in packages %}
    <div class="list-group-item">
      <div class="d-flex justify-content-between align-items-start">
        <div class="fw-semibold text-truncate" style="max-width: 70%;">{{ p.get("name","(no name)") }}</div>
        <div class="d-flex align-items-center gap-2">
          <div class="text-muted small">
            {% if p.get("running") %}RUN{% elif p.get("finished") %}DONE{% else %}IDLE{% endif %}
          </div>
          <form method="post" action="/remove" onsubmit="return confirm('Remove this package?');">
            <input type="hidden" name="package_id" value="{{ p.get('uuid','') }}">
            <button type="submit" class="btn btn-danger btn-sm">Remove</button>
          </form>
        </div>
      </div>
      <div class="small text-muted mt-1">
        {{ (p.get("bytesLoaded",0) / 1024 / 1024) | round(1) }} MB /
        {{ (p.get("bytesTotal",0) / 1024 / 1024) | round(1) }} MB
        · ETA: {{ p.get("eta","-") }}
        · Speed: {{ p.get("speed","-") }}
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}
